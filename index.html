<canvas id="ctx" style="position:absolute;top:0px;left:0px"></canvas>
<script src="three.min.js"></script>
<script src="OrbitControls.js"></script>
<script src="GLTFLoader.js"></script>
<script>
var WIDTH2 = window.innerWidth 
var HEIGHT2 = window.innerHeight
  ctx.width  = window.innerWidth 
  ctx.height = window.innerHeight
var sound={}
sound.green_hils= new Audio()
sound.green_hils.src='green_hils.wav'
sound.green_hils.volume=0.2


  
  
  
  
  var color_green = new THREE.MeshBasicMaterial({color:0x7fe000,vertexColors:THREE.FaceColors})
  var ploskost=new THREE.PlaneGeometry(855,855,32,32)
for(var i = 0; i < ploskost.faces.length; i++){
ploskost.faces[i].color.setRGB(Math.random(),Math.random(),Math.random())
}
var poll = new THREE.Mesh(ploskost,color_green)


var blockbox=new THREE.BoxGeometry(1,1,1)
//var pers = new THREE.Mesh(blockbox,color_green)
var pers2 = new THREE.Mesh(blockbox,color_green)




var rendrer = new THREE.WebGLRenderer({canvas:ctx,antialias: true})
rendrer.setClearColor(0x57d7eb)
var camera = new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,0.1,5000)
var scena = new THREE.Scene()
var ambientl = new THREE.AmbientLight(0xffffff,0.2)//0xffffff
scena.add(ambientl)
    const color = 0xffe3b0;//0xffe3b0
    const intensity = 1.5;//1.5
    const light = new THREE.DirectionalLight(color, intensity);
    light.position.set(5, 10, 2);
    scena.add(light);
    scena.add(light.target);

var mouc = new THREE.Vector2()
var vec = new THREE.Vector3()
var planenormal = new THREE.Vector3()
var plane = new THREE.Plane()
var raycaster = new THREE.Raycaster()

document.onmousemove = function(event){

mouc.x=(event.clientX/window.innerWidth) * 2 - 1
mouc.y=(event.clientY/window.innerHeight) * 2 - 1
mouc.y=-mouc.y
planenormal.copy(camera.position).normalize()
//plane.setFromNormalAndCoplanarPoint(planenormal, scena.position)
plane.constant=-0
plane.normal.x=0
plane.normal.y=1
plane.normal.z=0
raycaster.setFromCamera(mouc,camera)
raycaster.ray.intersectPlane(plane,vec)
}
var anglepers=0
var camcontroll=0
document.onmousedown = function(){
 sound.green_hils.play()
if(camcontroll===0){
pers2.position.copy(vec)
pers.lookAt(pers2.position.x,pers2.position.y,pers2.position.z)
}
/*

	var diffX = pers2.position.x - pers.position.x
	var diffY = pers2.position.z - pers.position.z

	
	
	anglepers = Math.atan2(diffY,diffX) / Math.PI * 180;
	pers.rotation.z=anglepers
	*/
}
//scena.add(poll)
poll.rotation.x-=90*Math.PI/180
//poll.position.y-=250



var pers = 0
var pers3 = 0
var loaddone = 0
var loaddone2 = 0
var locker2 = new THREE.Clock()
var glftload = new THREE.GLTFLoader()
glftload.load('https://starghosts2.github.io/archive/cozy_lake/scene.gltf',(gltfScene)=>{
model = gltfScene.scene
//model.position.x=150

//mixer.clipAction(gltfScene.animations[0]).play()

//pers.position.x-=300
model.position.y-=22
//pers.scale.set(210.5, 210.5, 210.5);
scena.add(model);
loaddone2=1
})
glftload.load('https://starghosts2.github.io/archive/pogo_the_bunny/scene.gltf',(gltfScene)=>{
model = gltfScene.scene
//model.position.x=150
mixer = new THREE.AnimationMixer(model)
//mixer.clipAction(gltfScene.animations[0]).play()
pers =model
pers3=gltfScene
//pers.position.x-=300
//pers.position.y-=250
//pers.scale.set(210.5, 210.5, 210.5);
scena.add(pers);
loaddone=1
})




scena.add(pers2)



var controls = new THREE.OrbitControls(camera, ctx);
camera.position.set(0,250,250)
controls.target.set(0, 5, 0);
controls.enablePan = false;
controls.enableZoom = false;
controls.enableRotate  = false;




var moveright=0
camera.position.set(0,150,150)



  document.onkeydown = function(event){
  if(event.code==='KeyZ'){
  controls.enableZoom = true;
  controls.enableRotate  = true;
  camcontroll=1
  }
  if(event.code==='KeyD'){
moveright=1
  }
  }
  document.onkeyup = function(event){
  if(event.code==='KeyZ'){
  controls.enableZoom = false;
  controls.enableRotate  = false;
  camcontroll=0
  }
  if(event.code==='KeyD'){
moveright=0
  }
  }

setInterval(function(){
if(loaddone===1&&loaddone2===1){
  ctx.width  = window.innerWidth 
  ctx.height = window.innerHeight
var oldX=pers.position.x
var oldY=pers.position.y
var oldZ=pers.position.z
if(pers.position.distanceTo(pers2.position)>3){
pers.translateZ( 1 )
mixer.clipAction(pers3.animations[0]).play()
}else{
mixer.clipAction(pers3.animations[0]).stop()
}
mixer.update(locker2.getDelta())
var diffX=pers.position.x-oldX
var diffY=pers.position.y-oldY
var diffZ=pers.position.z-oldZ
camera.position.x+=diffX
camera.position.y+=diffY
camera.position.z+=diffZ
controls.target.set(pers.position.x, pers.position.y, pers.position.z);
controls.update();
rendrer.render(scena,camera)
}
},1000/25)
</script>